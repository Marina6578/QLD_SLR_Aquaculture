---
title: "QueenslandGovRiskdata"
output: leases 
  pdf_document: Queensland Map of Aquacuture Leases and Erosion Risks
  html_document: Queensland Map of Aquacuture Leases and Erosion Risks
date: "2023-07-25"
---

#load packages I will need
```{r}
library(tidyverse)
library(here)
library(tmap)
library(sf)
library(ggplot2)
```
# load data
#Queensland leases data obtained from obtained from DAF and then ground truthed in the seascapes Lab

```{r}
qld_leases<-st_read(here("raw_data/QLD_aqua_ground_truth/QLD_terr_aquaculture_ground_truth.shp"))
```
#reproject data of the queensland leases and create a new column with the area of the polygons

```{r}
qld_leases_reproj<-st_transform(qld_leases, 3577)
qld_leases_reproj <- qld_leases_reproj %>%
  mutate(lease_area_m2 = st_area(.))

```
#load australia map
```{r}
Australia_map<- st_read(here("raw_data/Australia_country_SHP/AUS_2021_AUST_GDA2020.shp"))
```
#load data 
#Queensland state map

```{r}
Qld_map<-st_read(here("raw_data/AustralianStates_SHP/STE_2021_AUST_GDA2020.shp"))
```
#load data 
#Queensland erosion component 3 of sLR obtained https://qldspatial.information.qld.gov.au/catalogue/custom/search.page?q=%22Erosion%20prone%20area%20component%203%20of%203%20sea%20level%20rise%22

```{r}
QLD_coastal_erosion<-st_read(here("raw_data/QSC_EROSIONProne/Erosion_prone_area_component_3_of_3_sea_level_rise.shp"))
```

# reproject all data previously uploaded in shapefile (to 3577 -Australian Albers)

```{r}
Qld_reproj<-st_transform(Qld_map, 3577)

Australia_map_reproj<-st_transform(Australia_map, 3577)

QLD_coastal_erosion_reproj<-st_transform(QLD_coastal_erosion, 3577)
```

# Dissolve coastal erosion layer
```{r}
QLD_coastal_erosion_diss<-QLD_coastal_erosion_reproj %>%
  mutate(diss = 1) %>% #create column to dissolve by
  group_by(diss) %>% #group by column you created
  summarise(diss2 = sum(diss, na.rm = T)) #combine column into one new variable

```


#intersect  aquaculture leases with dissolved coastal erosion layer
```{r}

qld_leases_erosion<-st_intersection(QLD_coastal_erosion_diss, qld_leases_reproj)

```
```{r}
qld_leases_erosion <- qld_leases_erosion %>%
  mutate(affected_area_m2 = st_area(.),
         propaffecedArea= affected_area_m2/lease_area_m2)
```

#Create a shapefile of the intersection between the Aquaculture leases in Queensland and erosion prone areas in Queensland to check how many of them would be potetially affected
```{r}
st_write(qld_leases_erosion, here("output_data/qld_leases_erosion.shp"), delete_layer = TRUE)
```
```{r}
 nrow(qld_leases_erosion)
```


#just to take a look at tghe product call it something (you choose) and read it with the pathway
```{r}
aqua_intersect<-st_read(here("output_data/qld_leases_erosion.shp"))
```

#to take a look at 
```{r}
plot(st_geometry(QLD_coastal_erosion))

```

#Plot to see all that was uploaded and reprojected and if anything goes wrong try this #test<-st_make_valid(QLD_coastal_erosion)
```{r}
#test<-st_make_valid(QLD_coastal_erosion)
```



